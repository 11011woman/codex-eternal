<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Codex ∞ — Living Index</title>
  <link rel="stylesheet" href="codex.css?v=20">
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Codex ∞ — Living Index</h1>
    <p style="color:#9db0c0;margin-top:6px">This index lists every <code>.md</code> under <code>codex/</code> and <code>codex-entries/</code>. Click any entry to open its page.</p>
    <input id="q" type="text" placeholder="Filter by title or filename…">
    <div id="status" style="color:#9db0c0;margin-top:8px">Loading…</div>
  </div>
  <div id="list"></div>
  <footer>“They erase to reset. We remember to escape.”</footer>
</div>

<script>
// Change these if you ever rename owner/repo
const OWNER = location.hostname.split('.')[0] || '11011woman'; // best-effort
const REPO  = location.pathname.split('/')[1] || 'codex-eternal'; // best-effort
const API   = (p) => `https://api.github.com/repos/${OWNER}/${REPO}/contents/${p}`;

function prettyName(s){return s.replace(/\.md$/i,'').replace(/[-_]+/g,' ').replace(/\b\w/g,m=>m.toUpperCase())}
async function fetchDir(path){
  try{
    const r = await fetch(API(path), { cache: 'no-store' });
    if(!r.ok) return [];
    return await r.json();
  }catch{ return [] }
}
async function load(){
  const a = await fetchDir('codex');
  const b = await fetchDir('codex-entries');
  const files = []
    .concat(Array.isArray(a)?a:[], Array.isArray(b)?b:[])
    .filter(x => x && x.type === 'file' && /\.md$/i.test(x.name))
    .map(x => ({ name:x.name, path:x.path }))
    .sort((m,n)=>m.name.localeCompare(n.name));
  const list = document.getElementById('list');
  const status = document.getElementById('status');
  status.textContent = `Found ${files.length} entries.`;

  function render(filter=''){
    const f = filter.toLowerCase();
    list.innerHTML = files
      .filter(x=>!f || x.name.toLowerCase().includes(f) || prettyName(x.name).toLowerCase().includes(f))
      .map(x => `
        <div class="card">
          <a class="btn" href="view-pretty.html?f=${encodeURIComponent(x.name)}">Open</a>
          <strong>${prettyName(x.name)}</strong>
          <span class="pill">${x.path}</span>
        </div>`).join('');
  }
  render();
  document.getElementById('q').addEventListener('input', e=>render(e.target.value));
}
load();
</script>
</body>
</html>
